kind: pipeline
type: docker
name: default

steps:
- name: terraform-lint
  image: hashicorp/terraform:1.5.0
  when:
    branch: main
  commands:
    - "terraform fmt -diff -check -recursive"

- name: terraform-init
  image: hashicorp/terraform:1.5.0
  when:
    branch: main
  commands:
    - "terraform init"

- name: terraform-plan
  image: hashicorp/terraform:1.5.0
  secrets: [ metal_auth_token, project_name ]
  environment:
    METAL_AUTH_TOKEN:
      from_secret: metal_auth_token
    TF_VAR_project_name:
      from_secret: project_name
    TF_VAR_api_key:
      from_secret: metal_auth_token
  when:
    branch: main
  commands:
    - "terraform plan"
---
kind: signature
hmac: 2539d44cf0d800cba9934ad775441117e5ef344eed8ed5e9153cea817b3dae90 
